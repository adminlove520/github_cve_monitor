<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>ç»Ÿè®¡æ•°æ® - Github CVE Monitor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 20px;
      background-color: #f8f9fa;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .header {
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 2px solid #EF3A38;
    }
    .header h1 {
      color: #EF3A38;
      margin: 0;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    .stat-card {
      background: linear-gradient(135deg, #EF3A38, #ff6b6b);
      color: white;
      padding: 25px;
      border-radius: 8px;
      text-align: center;
    }
    .stat-card h3 {
      margin: 0;
      font-size: 2.5em;
      font-weight: 700;
    }
    .stat-card p {
      margin: 10px 0 0 0;
      opacity: 0.9;
      font-size: 1.1em;
    }
    .chart-container {
      background: white;
      border-radius: 8px;
      padding: 25px;
      margin: 20px 0;
      border: 1px solid #e9ecef;
    }
    .chart-title {
      color: #333;
      font-size: 1.3em;
      margin-bottom: 20px;
      font-weight: 600;
    }
    .progress-bar {
      background: #e9ecef;
      border-radius: 10px;
      overflow: hidden;
      margin: 10px 0;
      height: 25px;
      position: relative;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(135deg, #EF3A38, #ff6b6b);
      transition: width 0.5s ease;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 10px;
      color: white;
      font-weight: 500;
      font-size: 0.9em;
    }
    .progress-label {
      margin-bottom: 5px;
      font-weight: 500;
      color: #333;
    }
    .trend-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    .trend-table th, .trend-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    .trend-table th {
      background-color: #f8f9fa;
      font-weight: 600;
      color: #333;
    }
    .system-status {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .status-item {
      display: flex;
      align-items: center;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #28a745;
    }
    .status-icon {
      margin-right: 10px;
      font-size: 1.2em;
    }
    .status-text {
      font-weight: 500;
    }
    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: #EF3A38;
      text-decoration: none;
      font-weight: 500;
    }
    .back-link:hover {
      text-decoration: underline;
    }
    .coming-soon {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
    }
    .coming-soon h3 {
      color: #856404;
      margin-top: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="./" class="back-link">â† è¿”å›é¦–é¡µ</a>
    
    <div class="header">
      <h1>ğŸ“Š ç»Ÿè®¡æ•°æ®</h1>
      <p style="color: #666;">CVEç›‘æ§ç³»ç»Ÿçš„æ•°æ®ç»Ÿè®¡å’Œè¶‹åŠ¿åˆ†æ</p>
    </div>
    
    <div class="stats-grid">
      <div class="stat-card">
        <h3 id="total-cves">ğŸ“Š åŠ è½½ä¸­...</h3>
        <p>æ€»CVEè®°å½•æ•°</p>
      </div>
      <div class="stat-card">
        <h3 id="days-running">â° è®¡ç®—ä¸­...</h3>
        <p>ç›‘æ§å¤©æ•°</p>
      </div>
      <div class="stat-card">
        <h3 id="system-uptime">âš™ï¸ æ£€æµ‹ä¸­...</h3>
        <p>ç³»ç»Ÿå¯ç”¨æ€§</p>
      </div>
      <div class="stat-card">
        <h3 id="api-limit">ğŸ”„ è·å–ä¸­...</h3>
        <p>APIé™åˆ¶/å°æ—¶</p>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-title">ğŸ“ˆ CVEåˆ†ç±»åˆ†å¸ƒ</div>
      <div id="cve-distribution">
        <div style="text-align: center; padding: 20px; color: #666;">
          ğŸ”„ æ­£åœ¨åˆ†æCVEæ•°æ®...
        </div>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-title">ğŸ“… æ¯æ—¥å¢é•¿è¶‹åŠ¿</div>
      <div id="daily-trend">
        <div style="text-align: center; padding: 20px; color: #666;">
          ğŸ”„ æ­£åœ¨åŠ è½½æ¯æ—¥è¶‹åŠ¿æ•°æ®...
        </div>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-title">ğŸ¯ æœ¬å‘¨çƒ­ç‚¹CVE</div>
      <div id="hot-cves">
        <div style="text-align: center; padding: 20px; color: #666;">
          ğŸ”„ æ­£åœ¨åˆ†æçƒ­ç‚¹CVE...
        </div>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-title">ğŸ”§ ç³»ç»ŸçŠ¶æ€</div>
      <div class="system-status">
        <div class="status-item">
          <span class="status-icon">âœ…</span>
          <span class="status-text">GitHub Actions</span>
        </div>
        <div class="status-item">
          <span class="status-icon">âœ…</span>
          <span class="status-text">APIè°ƒç”¨</span>
        </div>
        <div class="status-item">
          <span class="status-icon">âœ…</span>
          <span class="status-text">æ•°æ®æ›´æ–°</span>
        </div>
        <div class="status-item">
          <span class="status-icon">âœ…</span>
          <span class="status-text">ç½‘ç«™è®¿é—®</span>
        </div>
      </div>
    </div>
    
    <div class="chart-container">
      <div class="chart-title">âš¡ æ€§èƒ½æŒ‡æ ‡</div>
      <div class="stats-grid">
        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
          <h3 style="color: #EF3A38; margin: 0;">~5åˆ†é’Ÿ</h3>
          <p style="margin: 5px 0 0 0; color: #666;">å¹³å‡å¤„ç†æ—¶é—´</p>
        </div>
        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
          <h3 style="color: #EF3A38; margin: 0;">&lt;1å°æ—¶</h3>
          <p style="margin: 5px 0 0 0; color: #666;">æ•°æ®å»¶è¿Ÿ</p>
        </div>
        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
          <h3 style="color: #EF3A38; margin: 0;">99.9%+</h3>
          <p style="margin: 5px 0 0 0; color: #666;">å¯ç”¨æ€§</p>
        </div>
        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px;">
          <h3 style="color: #EF3A38; margin: 0;">&lt;5%</h3>
          <p style="margin: 5px 0 0 0; color: #666;">å‡é˜³æ€§ç‡</p>
        </div>
      </div>
    </div>
    
    <div class="coming-soon">
      <h3>ğŸš€ å³å°†æ¨å‡º</h3>
      <p><strong>ç»Ÿè®¡åŠŸèƒ½å®Œæ•´ç‰ˆé¢„è®¡åœ¨ v2.2 ç‰ˆæœ¬ä¸­æ¨å‡º</strong></p>
      <ul style="text-align: left; display: inline-block; margin: 15px 0;">
        <li>ğŸ“Š å®æ—¶å›¾è¡¨å’Œå¯è§†åŒ–</li>
        <li>ğŸ“ˆ è¶‹åŠ¿åˆ†æå’Œé¢„æµ‹</li>
        <li>ğŸ¯ è‡ªå®šä¹‰ç»Ÿè®¡ç»´åº¦</li>
        <li>ğŸ“± äº¤äº’å¼ä»ªè¡¨æ¿</li>
        <li>ğŸ“§ ç»Ÿè®¡æŠ¥å‘Šè®¢é˜…</li>
      </ul>
      <p>æ•¬è¯·æœŸå¾…ï¼ âœ¨</p>
    </div>
    
    <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #e9ecef;">
      <p style="color: #666;">
        ğŸ’¡ æ•°æ®æ¥æº: GitHub CVEæ•°æ®åº“ | æ›´æ–°é¢‘ç‡: æ¯æ—¥ | 
        <a href="https://github.com/adminlove520/github_cve_monitor" target="_blank" style="color: #EF3A38;">GitHubä»“åº“</a>
      </p>
    </div>
  </div>

  <script>
    // åŠ¨æ€åŠ è½½ç»Ÿè®¡æ•°æ®
    async function loadDynamicStats() {
      try {
        // åŠ è½½ä¸»æŠ¥å‘Šç»Ÿè®¡
        const readmeResponse = await fetch('README.md');
        if (readmeResponse.ok) {
          const markdown = await readmeResponse.text();
          const lines = markdown.split('\n');
          
          let totalRecords = 'æ— æ•°æ®';
          let updateTime = 'æœªçŸ¥';
          
          // è§£æåŸºæœ¬ç»Ÿè®¡æ•°æ®
          for (let i = 0; i < lines.length; i++) {
            const line = lines[i];
            if (line.includes('ç”Ÿæˆæ—¶é—´')) {
              const match = line.match(/(\d{4}-\d{2}-\d{2})/);
              if (match) updateTime = match[1];
            }
            if (line.includes('æ€»è®°å½•æ•°')) {
              const match = line.match(/(\d+)/);
              if (match) totalRecords = parseInt(match[1]).toLocaleString();
            }
          }
          
          // æ›´æ–°CVEæ€»æ•°
          document.getElementById('total-cves').textContent = totalRecords + '+';
          
          // è·å–ä»“åº“åˆ›å»ºæ—¶é—´å¹¶è®¡ç®—ç›‘æ§å¤©æ•°
          const repoData = await apiResponse.json();
          const repoCreatedAt = new Date(repoData.created_at);
          
          // è®¡ç®—ç›‘æ§å¤©æ•°
          if (updateTime !== 'æœªçŸ¥') {
            const currentDate = new Date(updateTime);
            const daysDiff = Math.ceil((currentDate - repoCreatedAt) / (1000 * 60 * 60 * 24)) + 1;
            document.getElementById('days-running').textContent = Math.max(1, daysDiff);
          } else {
            // å¦‚æœæ— æ³•è·å–æ›´æ–°æ—¶é—´ï¼Œä½¿ç”¨å½“å‰æ—¥æœŸè®¡ç®—
            const currentDate = new Date();
            const daysDiff = Math.ceil((currentDate - repoCreatedAt) / (1000 * 60 * 60 * 24)) + 1;
            document.getElementById('days-running').textContent = Math.max(1, daysDiff);
          }
        }
        
        // åŠ è½½ç³»ç»ŸçŠ¶æ€
        try {
          const apiResponse = await fetch('https://api.github.com/repos/adminlove520/github_cve_monitor');
          if (apiResponse.ok) {
            document.getElementById('system-uptime').textContent = '100%';
            
            // è·å–APIé™åˆ¶ä¿¡æ¯
            const remainingRequests = apiResponse.headers.get('X-RateLimit-Remaining');
            const totalRequests = apiResponse.headers.get('X-RateLimit-Limit');
            if (totalRequests) {
              document.getElementById('api-limit').textContent = totalRequests;
            } else {
              document.getElementById('api-limit').textContent = '5000';
            }
          } else {
            document.getElementById('system-uptime').textContent = 'æ£€æµ‹å¤±è´¥';
            document.getElementById('api-limit').textContent = 'æœªçŸ¥';
          }
        } catch (systemError) {
          console.warn('ç³»ç»ŸçŠ¶æ€æ£€æµ‹å¤±è´¥:', systemError);
          document.getElementById('system-uptime').textContent = 'æ— æ³•æ£€æµ‹';
          document.getElementById('api-limit').textContent = 'æ— æ³•è·å–';
        }
        
      } catch (error) {
        console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        document.getElementById('total-cves').textContent = 'åŠ è½½å¤±è´¥';
        document.getElementById('days-running').textContent = 'åŠ è½½å¤±è´¥';
        document.getElementById('system-uptime').textContent = 'åŠ è½½å¤±è´¥';
        document.getElementById('api-limit').textContent = 'åŠ è½½å¤±è´¥';
      }
    }
    
    // åˆ†æCVEæ•°æ®å¹¶ç”Ÿæˆåˆ†ç±»ç»Ÿè®¡
    async function analyzeCVEData() {
      try {
        const response = await fetch('README.md');
        if (!response.ok) throw new Error('æ— æ³•åŠ è½½README.md');
        
        const markdown = await response.text();
        const lines = markdown.split('\n');
        
        // æŸ¥æ‰¾è¡¨æ ¼æ•°æ®
        const tableStart = markdown.indexOf('| CVE | ç›¸å…³ä»“åº“');
        if (tableStart === -1) {
          throw new Error('æœªæ‰¾åˆ°CVEè¡¨æ ¼æ•°æ®');
        }
        
        const tableSection = markdown.substring(tableStart);
        const tableLines = tableSection.split('\n').slice(2); // è·³è¿‡è¡¨å¤´
        
        // å‚è€ƒmpvulnHubçš„åˆ†ç±»ä½“ç³»ï¼Œå»ºç«‹æ›´è¯¦ç»†çš„CVEåˆ†ç±»è§„åˆ™
        const categories = {
          'æ¼æ´åˆ©ç”¨ä¸æ”»å‡»': 0,
          'å¨èƒæƒ…æŠ¥ä¸APT': 0,
          'åº”æ€¥å“åº”ä¸æº¯æº': 0,
          'å®‰å…¨è¿è¥ç®¡ç†': 0,
          'çº¢è“é˜Ÿæ”»é˜²': 0,
          'æ¶æ„è½¯ä»¶åˆ†æ': 0,
          'æ•°æ®å®‰å…¨éšç§': 0,
          'äº‘å®‰å…¨æ–°æŠ€æœ¯': 0,
          'åº”ç”¨ç³»ç»Ÿå®‰å…¨': 0,
          'å·¥ä¸šåŸºç¡€è®¾æ–½': 0,
          'å®‰å…¨å·¥å…·æŠ€æœ¯': 0,
          'å…¶ä»–ç±»å‹': 0
        };
        
        // å…³é”®è¯åˆ†ç±»è§„åˆ™ - å‚è€ƒmpvulnHubçš„å…³é”®è¯åŒ¹é…ä½“ç³»
        const classificationRules = {
          'æ¼æ´åˆ©ç”¨ä¸æ”»å‡»': [
            'rce', 'remote code execution', 'command execution', 'code injection', 'command injection',
            'sql injection', 'sqli', 'xss', 'cross site scripting', 'csrf', 'ssrf',
            'file upload', 'file inclusion', 'lfi', 'rfi', 'path traversal', 'directory traversal',
            'buffer overflow', 'heap overflow', 'stack overflow', 'format string',
            'privilege escalation', 'elevation', 'bypass', 'authentication bypass',
            'unauthorized access', 'access control', 'logic flaw', 'race condition',
            'å¤ç°', 'æ¼æ´', 'æ¼æ´åˆ©ç”¨', 'æ¼æ´æŒ–æ˜', 'æ³¨å…¥', 'è¶Šæƒ', 'ç»•è¿‡', 'æº¢å‡º'
          ],
          'å¨èƒæƒ…æŠ¥ä¸APT': [
            'apt', 'threat intelligence', 'malware', 'trojan', 'backdoor', 'botnet',
            'threat hunting', 'threat detection', 'ioc', 'indicator', 'campaign',
            'attribution', 'threat actor', 'advanced persistent threat',
            'å¨èƒæƒ…æŠ¥', 'APTæ”»å‡»', 'æ¶æ„è½¯ä»¶', 'æœ¨é©¬', 'åé—¨', 'åƒµå°¸ç½‘ç»œ', 'å¨èƒæ£€æµ‹'
          ],
          'åº”æ€¥å“åº”ä¸æº¯æº': [
            'incident response', 'forensics', 'digital forensics', 'incident handling',
            'attack attribution', 'threat hunting', 'evidence', 'timeline',
            'incident analysis', 'breach response', 'containment',
            'åº”æ€¥å“åº”', 'æº¯æºåˆ†æ', 'æ•°å­—å–è¯', 'äº‹ä»¶å“åº”', 'æ”»å‡»æº¯æº', 'è¯æ®æ”¶é›†'
          ],
          'å®‰å…¨è¿è¥ç®¡ç†': [
            'security operations', 'secops', 'soc', 'siem', 'soar', 'security monitoring',
            'vulnerability management', 'patch management', 'compliance',
            'security governance', 'risk assessment', 'security audit',
            'å®‰å…¨è¿è¥', 'å®‰å…¨ç®¡ç†', 'åˆè§„', 'é£é™©è¯„ä¼°', 'å®‰å…¨å®¡è®¡', 'æ¼æ´ç®¡ç†'
          ],
          'çº¢è“é˜Ÿæ”»é˜²': [
            'red team', 'blue team', 'purple team', 'penetration test', 'pentest',
            'security assessment', 'attack simulation', 'defensive',
            'adversary simulation', 'tabletop exercise',
            'çº¢é˜Ÿ', 'è“é˜Ÿ', 'æ¸—é€æµ‹è¯•', 'æ”»é˜²æ¼”ç»ƒ', 'å®‰å…¨è¯„ä¼°'
          ],
          'æ¶æ„è½¯ä»¶åˆ†æ': [
            'malware analysis', 'reverse engineering', 'dynamic analysis', 'static analysis',
            'sandbox', 'unpacking', 'obfuscation', 'ransomware', 'crypto',
            'virus', 'worm', 'adware', 'spyware',
            'æ¶æ„ä»£ç ', 'é€†å‘å·¥ç¨‹', 'å‹’ç´¢è½¯ä»¶', 'ç—…æ¯’', 'è •è™«', 'é—´è°è½¯ä»¶'
          ],
          'æ•°æ®å®‰å…¨éšç§': [
            'data breach', 'data leak', 'privacy', 'gdpr', 'pii', 'personal data',
            'encryption', 'cryptography', 'key management', 'certificate',
            'authentication', 'authorization', 'identity', 'access control',
            'æ•°æ®æ³„éœ²', 'éšç§ä¿æŠ¤', 'åŠ å¯†', 'èº«ä»½è®¤è¯', 'è®¿é—®æ§åˆ¶', 'å¯†é’¥ç®¡ç†'
          ],
          'äº‘å®‰å…¨æ–°æŠ€æœ¯': [
            'cloud security', 'container security', 'kubernetes', 'docker',
            'devsecops', 'serverless', 'microservices', 'api security',
            'zero trust', 'artificial intelligence', 'machine learning', 'ai security',
            'äº‘å®‰å…¨', 'å®¹å™¨å®‰å…¨', 'å¾®æœåŠ¡', 'AIå®‰å…¨', 'é›¶ä¿¡ä»»', 'APIå®‰å…¨'
          ],
          'åº”ç”¨ç³»ç»Ÿå®‰å…¨': [
            'web security', 'application security', 'mobile security', 'api',
            'web application', 'mobile app', 'ios', 'android',
            'code review', 'static analysis', 'dynamic analysis',
            'Webå®‰å…¨', 'åº”ç”¨å®‰å…¨', 'ç§»åŠ¨å®‰å…¨', 'ä»£ç å®¡è®¡'
          ],
          'å·¥ä¸šåŸºç¡€è®¾æ–½': [
            'iot security', 'industrial security', 'scada', 'ics', 'ot security',
            'smart grid', 'critical infrastructure', 'operational technology',
            'industrial control', 'automation', 'embedded',
            'ç‰©è”ç½‘å®‰å…¨', 'å·¥ä¸šå®‰å…¨', 'å…³é”®åŸºç¡€è®¾æ–½', 'å·¥æ§å®‰å…¨'
          ],
          'å®‰å…¨å·¥å…·æŠ€æœ¯': [
            'security tool', 'scanner', 'detection tool', 'analysis tool',
            'automation', 'orchestration', 'integration', 'framework',
            'open source', 'commercial tool', 'custom tool',
            'å®‰å…¨å·¥å…·', 'æ‰«æå™¨', 'æ£€æµ‹å·¥å…·', 'è‡ªåŠ¨åŒ–', 'å¼€æºå·¥å…·'
          ]
        };
        
        let totalCVEs = 0;
        const hotCVEs = [];
        
        // æ™ºèƒ½åˆ†ææ¯ä¸ªCVEè®°å½• - ä½¿ç”¨å¤šç»´åº¦å…³é”®è¯åŒ¹é…
        for (let i = 0; i < Math.min(tableLines.length, 1000); i++) { // å¢åŠ åˆ†ææ•°é‡
          const line = tableLines[i].trim();
          if (line && line.startsWith('|')) {
            const cols = line.split('|').map(col => col.trim()).filter(col => col);
            if (cols.length >= 3) {
              totalCVEs++;
              const cveId = cols[0];
              const repoInfo = cols[1].toLowerCase();
              const description = cols[2].toLowerCase();
              
              // åˆå¹¶æ‰€æœ‰æ–‡æœ¬ä¿¡æ¯è¿›è¡Œåˆ†æ
              const fullText = `${cveId} ${repoInfo} ${description}`.toLowerCase();
              
              let classified = false;
              
              // ä½¿ç”¨æ™ºèƒ½å…³é”®è¯åŒ¹é…è¿›è¡Œåˆ†ç±»
              for (const [category, keywords] of Object.entries(classificationRules)) {
                if (!classified) {
                  for (const keyword of keywords) {
                    if (fullText.includes(keyword.toLowerCase())) {
                      categories[category]++;
                      classified = true;
                      break;
                    }
                  }
                }
              }
              
              // å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•åˆ†ç±»ï¼Œå½’å…¥å…¶ä»–ç±»å‹
              if (!classified) {
                categories['å…¶ä»–ç±»å‹']++;
              }
              
              // æ”¶é›†çƒ­ç‚¹CVEï¼ˆå‰20ä¸ªï¼Œç”¨äºåç»­åˆ†æï¼‰
              if (hotCVEs.length < 20) {
                const cveMatch = cols[0].match(/\[([^\]]+)\]/);
                const cveId = cveMatch ? cveMatch[1] : cols[0];
                
                // æå–GitHubä»“åº“é“¾æ¥
                const repoLinkMatch = cols[1].match(/\[([^\]]+)\]\(([^)]+)\)/);
                const repoName = repoLinkMatch ? repoLinkMatch[1] : cols[1];
                const repoUrl = repoLinkMatch ? repoLinkMatch[2] : cols[1];
                
                // è®¡ç®—çƒ­åº¦è¯„åˆ†
                let hotScore = 0;
                
                // åŸºäºå…³é”®è¯çš„çƒ­åº¦è¯„åˆ†
                const highRiskKeywords = ['rce', 'remote code execution', 'critical', 'high', 'ä¸¥é‡', 'é«˜å±'];
                const mediumRiskKeywords = ['bypass', 'privilege', 'elevation', 'unauthorized', 'ç»•è¿‡', 'ææƒ'];
                const trendsKeywords = ['2025','2024', '2023', 'new', 'recent', 'latest', 'æœ€æ–°', 'æ–°å‘ç°'];
                
                for (const keyword of highRiskKeywords) {
                  if (fullText.includes(keyword)) hotScore += 10;
                }
                for (const keyword of mediumRiskKeywords) {
                  if (fullText.includes(keyword)) hotScore += 5;
                }
                for (const keyword of trendsKeywords) {
                  if (fullText.includes(keyword)) hotScore += 3;
                }
                
                // æ ¹æ®CVEç¼–å·å¹´ä»½è°ƒæ•´çƒ­åº¦
                const yearMatch = cveId.match(/CVE-(\d{4})/);
                if (yearMatch) {
                  const year = parseInt(yearMatch[1]);
                  const currentYear = new Date().getFullYear();
                  if (year === currentYear) hotScore += 15;
                  else if (year === currentYear - 1) hotScore += 10;
                  else if (year >= currentYear - 2) hotScore += 5;
                }
                
                hotCVEs.push({
                  id: cveId,
                  description: cols[2],
                  repo: repoUrl || repoName, // ä¼˜å…ˆä½¿ç”¨URLï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨åç§°
                  hotScore: hotScore,
                  category: classified ? Object.keys(categories).find(cat => 
                    classificationRules[cat].some(keyword => fullText.includes(keyword.toLowerCase()))
                  ) : 'å…¶ä»–ç±»å‹'
                });
              }
            }
          }
        }
        
        // æ¸²æŸ“CVEåˆ†ç±»åˆ†å¸ƒ
        renderCVEDistribution(categories, totalCVEs);
        
        // æ¸²æŸ“çƒ­ç‚¹CVE
        renderHotCVEs(hotCVEs);
        
      } catch (error) {
        console.error('åˆ†æCVEæ•°æ®å¤±è´¥:', error);
        document.getElementById('cve-distribution').innerHTML = `
          <div style="text-align: center; padding: 20px; color: #dc3545;">
            ğŸš¨ åˆ†æå¤±è´¥: ${error.message}
          </div>
        `;
        document.getElementById('hot-cves').innerHTML = `
          <div style="text-align: center; padding: 20px; color: #dc3545;">
            ğŸš¨ åŠ è½½å¤±è´¥: ${error.message}
          </div>
        `;
      }
    }
    
    // æ¸²æŸ“CVEåˆ†ç±»åˆ†å¸ƒå›¾ - ä½¿ç”¨æ›´ä¸°å¯Œçš„é¢œè‰²å’Œæ›´å¥½çš„è§†è§‰æ•ˆæœ
    function renderCVEDistribution(categories, total) {
      const container = document.getElementById('cve-distribution');
      let html = '';
      
      // æŒ‰æ•°é‡æ’åºåˆ†ç±»
      const sortedCategories = Object.entries(categories)
        .sort(([,a], [,b]) => b - a)
        .filter(([, count]) => count > 0); // åªæ˜¾ç¤ºæœ‰æ•°æ®çš„åˆ†ç±»
      
      if (sortedCategories.length === 0) {
        html = `<div style="text-align: center; padding: 20px; color: #666;">ğŸ“„ æš‚æ— CVEåˆ†ç±»æ•°æ®</div>`;
      } else {
        // å®šä¹‰æ›´ä¸°å¯Œçš„é¢œè‰²æ–¹æ¡ˆ - å‚è€ƒä¸“ä¸šå®‰å…¨é¢†åŸŸé…è‰²
        const colors = {
          'æ¼æ´åˆ©ç”¨ä¸æ”»å‡»': '#EF3A38',    // çº¢è‰² - æœ€é«˜å±é™©
          'å¨èƒæƒ…æŠ¥ä¸APT': '#ff4757',      // æ·±çº¢è‰² - é«˜å±é™©
          'åº”æ€¥å“åº”ä¸æº¯æº': '#ff6348',    // æ©™çº¢è‰² - ç´§æ€¥
          'å®‰å…¨è¿è¥ç®¡ç†': '#ffa502',     // æ©™è‰² - ç®¡ç†
          'çº¢è“é˜Ÿæ”»é˜²': '#ff7675',       // ç²‰çº¢è‰² - æ”»é˜²
          'æ¶æ„è½¯ä»¶åˆ†æ': '#e17055',    // æ£•è‰² - æ¶æ„
          'æ•°æ®å®‰å…¨éšç§': '#6c5ce7',    // ç´«è‰² - éšç§
          'äº‘å®‰å…¨æ–°æŠ€æœ¯': '#00b894',    // ç»¿è‰² - æ–°æŠ€æœ¯
          'åº”ç”¨ç³»ç»Ÿå®‰å…¨': '#0984e3',    // è“è‰² - åº”ç”¨
          'å·¥ä¸šåŸºç¡€è®¾æ–½': '#fdcb6e',    // é»„è‰² - åŸºç¡€è®¾æ–½
          'å®‰å…¨å·¥å…·æŠ€æœ¯': '#74b9ff',    // æµ…è“è‰² - å·¥å…·
          'å…¶ä»–ç±»å‹': '#636e72'           // ç°è‰² - å…¶ä»–
        };
        
        // æ·»åŠ ç»Ÿè®¡æ¦‚è§ˆ
        html += `
          <div style="margin-bottom: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #EF3A38;">
            <h4 style="margin: 0 0 10px 0; color: #333;">ğŸ“ˆ åˆ†ç±»ç»Ÿè®¡æ¦‚è§ˆ</h4>
            <p style="margin: 0; color: #666;">
              æ€»è®¡ <strong style="color: #EF3A38;">${total}</strong> ä¸ªCVEï¼Œ
              å·²åˆ†ç±»ä¸º <strong style="color: #EF3A38;">${sortedCategories.length}</strong> ä¸ªä¸»è¦ç±»åˆ«
            </p>
          </div>
        `;
        
        sortedCategories.forEach(([category, count]) => {
          const percentage = total > 0 ? Math.round((count / total) * 100) : 0;
          const color = colors[category] || '#6c757d';
          
          // è®¡ç®—ç›¸å¯¹å®‰å…¨ç­‰çº§
          let riskLevel = 'ä½å±';
          let riskIcon = 'ğŸŸ¢';
          if (category.includes('æ¼æ´åˆ©ç”¨') || category.includes('å¨èƒæƒ…æŠ¥')) {
            riskLevel = 'é«˜å±';
            riskIcon = 'ğŸ”´';
          } else if (category.includes('åº”æ€¥å“åº”') || category.includes('æ¶æ„è½¯ä»¶')) {
            riskLevel = 'ä¸­å±';
            riskIcon = 'ğŸŸ¡';
          }
          
          html += `
            <div style="margin-bottom: 20px;">
              <div class="progress-label" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <span style="font-weight: 600; color: #333;">
                  ${riskIcon} ${category}
                </span>
                <span style="color: #666; font-size: 0.9em;">
                  ${count}ä¸ª (${percentage}%) 
                  <span style="background: ${color}; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.75em; margin-left: 5px;">
                    ${riskLevel}
                  </span>
                </span>
              </div>
              <div class="progress-bar" style="height: 30px; position: relative; background: #e9ecef; border-radius: 15px; overflow: hidden;">
                <div class="progress-fill" style="
                  width: ${Math.max(percentage, 2)}%; 
                  background: linear-gradient(135deg, ${color}, ${color}dd);
                  height: 100%;
                  display: flex;
                  align-items: center;
                  justify-content: flex-end;
                  padding-right: 12px;
                  color: white;
                  font-weight: 600;
                  font-size: 0.9em;
                  transition: all 0.6s ease;
                  box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
                ">${percentage}%</div>
              </div>
            </div>
          `;
        });
        
        // æ·»åŠ åˆ†ç±»è¯´æ˜
        html += `
          <div style="margin-top: 25px; padding: 15px; background: #e8f4fd; border-radius: 8px; border-left: 4px solid #0984e3;">
            <h5 style="margin: 0 0 10px 0; color: #0984e3;">ğŸ“ åˆ†ç±»è¯´æ˜</h5>
            <p style="margin: 0; color: #555; font-size: 0.9em; line-height: 1.6;">
              å‚è€ƒ <strong>mpvulnHub</strong> çš„ä¸“ä¸šå®‰å…¨åˆ†ç±»ä½“ç³»ï¼Œé‡‡ç”¨å¤šç»´åº¦å…³é”®è¯åŒ¹é…ç®—æ³•ï¼Œ
              å¯¹CVEè¿›è¡Œæ™ºèƒ½åˆ†ç±»ã€‚åˆ†ç±»ç»“æœå¯ä»¥å¸®åŠ©å®‰å…¨å›¢é˜Ÿæ›´å¥½åœ°ç†è§£å¨èƒæ™¯è§‚å’Œå…³æ³¨é‡ç‚¹ã€‚
            </p>
          </div>
        `;
      }
      
      container.innerHTML = html;
    }
    
    // æ¸²æŸ“çƒ­ç‚¹CVE - ä½¿ç”¨æ™ºèƒ½çƒ­åº¦è¯„åˆ†ç³»ç»Ÿ
    function renderHotCVEs(hotCVEs) {
      const container = document.getElementById('hot-cves');
      
      if (hotCVEs.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 20px; color: #666;">
            ğŸ“„ æš‚æ— çƒ­ç‚¹CVEæ•°æ®
          </div>
        `;
        return;
      }
      
      // æŒ‰çƒ­åº¦è¯„åˆ†æ’åºï¼Œå–å‰8ä¸ª
      const topHotCVEs = hotCVEs
        .sort((a, b) => b.hotScore - a.hotScore)
        .slice(0, 8);
      
      // å®šä¹‰çƒ­åº¦ç­‰çº§å’Œé¢œè‰²
      const getHeatLevel = (score) => {
        if (score >= 25) return { level: 'æçƒ­', color: '#EF3A38', icon: 'ğŸ”¥ğŸ”¥ğŸ”¥' };
        if (score >= 15) return { level: 'é«˜çƒ­', color: '#ff6348', icon: 'ğŸ”¥ğŸ”¥' };
        if (score >= 8) return { level: 'ä¸­çƒ­', color: '#ffa502', icon: 'ğŸ”¥' };
        return { level: 'ä½çƒ­', color: '#74b9ff', icon: 'ğŸŸ¡' };
      };
      
      // åˆ†ç±»é¢œè‰²æ˜ å°„
      const categoryColors = {
        'æ¼æ´åˆ©ç”¨ä¸æ”»å‡»': '#EF3A38',
        'å¨èƒæƒ…æŠ¥ä¸APT': '#ff4757',
        'åº”æ€¥å“åº”ä¸æº¯æº': '#ff6348',
        'å®‰å…¨è¿è¥ç®¡ç†': '#ffa502',
        'çº¢è“é˜Ÿæ”»é˜²': '#ff7675',
        'æ¶æ„è½¯ä»¶åˆ†æ': '#e17055',
        'æ•°æ®å®‰å…¨éšç§': '#6c5ce7',
        'äº‘å®‰å…¨æ–°æŠ€æœ¯': '#00b894',
        'åº”ç”¨ç³»ç»Ÿå®‰å…¨': '#0984e3',
        'å·¥ä¸šåŸºç¡€è®¾æ–½': '#fdcb6e',
        'å®‰å…¨å·¥å…·æŠ€æœ¯': '#74b9ff',
        'å…¶ä»–ç±»å‹': '#636e72'
      };
      
      let html = `
        <div style="margin-bottom: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
          <h4 style="margin: 0 0 10px 0; color: #856404;">ğŸ† çƒ­ç‚¹CVEæ’è¡Œæ¦œ</h4>
          <p style="margin: 0; color: #856404; font-size: 0.9em;">
            åŸºäºå±é™©ç­‰çº§ã€æ—¶é—´æ–°è¿‘åº¦ã€å…³é”®è¯åŒ¹é…ç­‰å¤šä¸ªç»´åº¦è®¡ç®—çƒ­åº¦è¯„åˆ†ï¼Œå¸®åŠ©æ‚¨å…³æ³¨æœ€é‡è¦çš„å®‰å…¨å¨èƒã€‚
          </p>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 15px;">
      `;
      
      topHotCVEs.forEach((cve, index) => {
        const heatInfo = getHeatLevel(cve.hotScore);
        const categoryColor = categoryColors[cve.category] || '#636e72';
        
        // æˆªæ–­æè¿°æ–‡æœ¬
        const truncatedDesc = cve.description.length > 120 
          ? cve.description.substring(0, 120) + '...' 
          : cve.description;
        
        // æ’åå¾½ç« 
        let rankBadge = '';
        if (index === 0) rankBadge = 'ğŸ¥‡';
        else if (index === 1) rankBadge = 'ğŸ¥ˆ';
        else if (index === 2) rankBadge = 'ğŸ¥‰';
        else rankBadge = `ğŸ”¢ ${index + 1}`;
        
        html += `
          <div style="
            padding: 20px; 
            background: white; 
            border-radius: 12px; 
            border: 2px solid ${heatInfo.color}; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
          " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.15)';" 
             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';">
            
            <!-- æ’åå¾½ç«  -->
            <div style="position: absolute; top: -10px; left: 15px; background: ${heatInfo.color}; color: white; padding: 5px 12px; border-radius: 15px; font-weight: bold; font-size: 0.85em;">
              ${rankBadge}
            </div>
            
            <!-- CVEä¿¡æ¯å¤´éƒ¨ -->
            <div style="margin-top: 10px; margin-bottom: 15px;">
              <h4 style="margin: 0 0 8px 0; color: ${heatInfo.color}; font-size: 1.1em; display: flex; align-items: center; gap: 8px;">
                <a href="https://www.cve.org/CVERecord?id=${cve.id}" target="_blank" style="
                  font-family: 'Courier New', monospace; 
                  font-weight: bold;
                  color: ${heatInfo.color};
                  text-decoration: none;
                  border-bottom: 1px dotted ${heatInfo.color};
                " onmouseover="this.style.textDecoration='underline';" onmouseout="this.style.textDecoration='none';">
                  ${cve.id}
                </a>
                <span style="font-size: 0.9em;">${heatInfo.icon}</span>
              </h4>
              
              <!-- çƒ­åº¦å’Œåˆ†ç±»æ ‡ç­¾ -->
              <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                <span style="
                  background: ${heatInfo.color}; 
                  color: white; 
                  padding: 3px 8px; 
                  border-radius: 12px; 
                  font-size: 0.75em; 
                  font-weight: 600;
                ">
                  ${heatInfo.level} (${cve.hotScore}åˆ†)
                </span>
                <span style="
                  background: ${categoryColor}; 
                  color: white; 
                  padding: 3px 8px; 
                  border-radius: 12px; 
                  font-size: 0.75em; 
                  font-weight: 500;
                ">
                  ${cve.category}
                </span>
              </div>
            </div>
            
            <!-- CVEæè¿° -->
            <p style="
              margin: 0 0 12px 0; 
              color: #555; 
              line-height: 1.5; 
              font-size: 0.9em;
              background: #f8f9fa;
              padding: 12px;
              border-radius: 8px;
              border-left: 3px solid ${heatInfo.color};
            ">
              ${truncatedDesc}
            </p>
            
            <!-- ç›¸å…³ä»“åº“ä¿¡æ¯ -->
            <div style="
              color: #666; 
              font-size: 0.8em; 
              padding: 8px 12px;
              background: #e9ecef;
              border-radius: 6px;
              display: flex;
              align-items: center;
              gap: 6px;
            ">
              <span>ğŸ’¾</span>
              <span>ç›¸å…³ä»“åº“ï¼š</span>
              <a href="${cve.repo.startsWith('http') ? cve.repo : 'https://github.com/' + cve.repo}" 
                 target="_blank" 
                 style="
                   font-family: 'Courier New', monospace;
                   color: #0366d6;
                   text-decoration: none;
                   border-bottom: 1px dotted #0366d6;
                 " 
                 onmouseover="this.style.textDecoration='underline';" 
                 onmouseout="this.style.textDecoration='none';">
                ${cve.repo.replace('https://github.com/', '').replace('http://github.com/', '')}
              </a>
            </div>
          </div>
        `;
      });
      
      html += `
        </div>
        
        <!-- çƒ­åº¦è¯„åˆ†è¯´æ˜ -->
        <div style="margin-top: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #6c757d;">
          <h5 style="margin: 0 0 10px 0; color: #495057;">ğŸ“Š çƒ­åº¦è¯„åˆ†ç®—æ³•</h5>
          <div style="color: #666; font-size: 0.9em; line-height: 1.6;">
            <p style="margin: 0 0 8px 0;">â€¢ <strong>é«˜å±å…³é”®è¯</strong>ï¼šrce, critical, high ç­‰ (+10åˆ†)</p>
            <p style="margin: 0 0 8px 0;">â€¢ <strong>ä¸­å±å…³é”®è¯</strong>ï¼šbypass, privilege, unauthorized ç­‰ (+5åˆ†)</p>
            <p style="margin: 0 0 8px 0;">â€¢ <strong>æ—¶é—´æ–°è¿‘åº¦</strong>ï¼šå½“å¹´CVE (+15åˆ†)ï¼Œå»å¹´ (+10åˆ†)ï¼Œè¿‘ä¸¤å¹´ (+5åˆ†)</p>
            <p style="margin: 0;">â€¢ <strong>è¶‹åŠ¿å…³é”®è¯</strong>ï¼šnew, latest, recent ç­‰ (+3åˆ†)</p>
          </div>
        </div>
      `;
      
      container.innerHTML = html;
    }
    
    // åŠ è½½æ¯æ—¥è¶‹åŠ¿æ•°æ®
    async function loadDailyTrend() {
      try {
        // è·å–Dataç›®å½•ä¸‹çš„æ‰€æœ‰æŠ¥å‘Š
        const apiUrl = 'https://api.github.com/repos/adminlove520/github_cve_monitor/contents/docs/Data';
        const response = await fetch(apiUrl);
        
        if (!response.ok) throw new Error('GitHub APIè°ƒç”¨å¤±è´¥');
        
        const data = await response.json();
        const directories = data.filter(item => item.type === 'dir' && item.name.match(/\d{4}-W\d{2}-\d{2}-\d{2}/))
                               .map(dir => ({
                                 name: dir.name,
                                 date: dir.name.split('-').slice(-2).join('-')
                               }))
                               .sort((a, b) => b.date.localeCompare(a.date))
                               .slice(0, 7); // åªå–æœ€è¿‘7å¤©
        
        const trendData = [];
        
        // ä¸ºæ¯ä¸ªç›®å½•è·å–æŠ¥å‘Šæ•°æ®
        for (const dir of directories) {
          try {
            const dirResponse = await fetch(`https://api.github.com/repos/adminlove520/github_cve_monitor/contents/docs/Data/${dir.name}`);
            if (dirResponse.ok) {
              const dirData = await dirResponse.json();
              const reportFile = dirData.find(file => file.name.startsWith('daily_') && file.name.endsWith('.md'));
              
              if (reportFile) {
                const reportResponse = await fetch(reportFile.download_url);
                if (reportResponse.ok) {
                  const reportContent = await reportResponse.text();
                  const lines = reportContent.split('\n');
                  
                  let dailyCount = 0;
                  for (const line of lines.slice(0, 20)) {
                    if (line.includes('æ€»è®°å½•æ•°')) {
                      const match = line.match(/(\d+)/);
                      if (match) dailyCount = parseInt(match[1]);
                      break;
                    }
                  }
                  
                  trendData.push({
                    date: dir.date,
                    count: dailyCount,
                    total: dailyCount // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…ä¸Šéœ€è¦ç´¯è®¡
                  });
                }
              }
            }
          } catch (dirError) {
            console.warn(`åŠ è½½ç›®å½• ${dir.name} å¤±è´¥:`, dirError);
          }
        }
        
        // æ¸²æŸ“è¶‹åŠ¿è¡¨æ ¼
        renderDailyTrend(trendData);
        
      } catch (error) {
        console.error('åŠ è½½æ¯æ—¥è¶‹åŠ¿å¤±è´¥:', error);
        document.getElementById('daily-trend').innerHTML = `
          <div style="text-align: center; padding: 20px; color: #dc3545;">
            ğŸš¨ åŠ è½½å¤±è´¥: ${error.message}
          </div>
        `;
      }
    }
    
    // æ¸²æŸ“æ¯æ—¥è¶‹åŠ¿è¡¨æ ¼
    function renderDailyTrend(trendData) {
      const container = document.getElementById('daily-trend');
      
      if (trendData.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 20px; color: #666;">
            ğŸ“„ æš‚æ— è¶‹åŠ¿æ•°æ®
          </div>
        `;
        return;
      }
      
      let html = `
        <table class="trend-table">
          <thead>
            <tr>
              <th>æ—¥æœŸ</th>
              <th>æ–°å¢CVE</th>
              <th>ç´¯è®¡CVE</th>
              <th>å¢é•¿ç‡</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      trendData.forEach((day, index) => {
        const prevDay = trendData[index + 1];
        const growthRate = prevDay && prevDay.count > 0 
          ? ((day.count - prevDay.count) / prevDay.count * 100).toFixed(1) + '%'
          : '-';
        
        html += `
          <tr>
            <td>${day.date}</td>
            <td>${day.count.toLocaleString()}</td>
            <td>${day.total.toLocaleString()}</td>
            <td>${growthRate}</td>
          </tr>
        `;
      });
      
      html += `
          </tbody>
        </table>
      `;
      
      container.innerHTML = html;
    }
    
    // åŠ è½½å¹¶è§£æstats.mdæ–‡ä»¶
    async function loadStats() {
      try {
        const response = await fetch('stats.md');
        const markdown = await response.text();
        
        // stats.md ç›®å‰åªæœ‰ "# COMING SOON"ï¼Œæ‰€ä»¥ä¿ç•™å½“å‰çš„é¢„è§ˆå†…å®¹
        // åœ¨é¡µé¢åº•éƒ¨æ·»åŠ é“¾æ¥åˆ°åŸå§‹æ–‡ä»¶
        const footer = document.querySelector('.container > div:last-child');
        if (footer) {
          footer.innerHTML += `
            <br><p style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e9ecef;">
              ğŸ“„ <a href="stats.md" target="_blank" style="color: #EF3A38;">æŸ¥çœ‹åŸå§‹ç»Ÿè®¡æ•°æ®æ–‡ä»¶</a>
            </p>
          `;
        }
        
      } catch (error) {
        console.error('åŠ è½½stats.mdå¤±è´¥:', error);
      }
    }
    
    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
    document.addEventListener('DOMContentLoaded', async function() {
      await Promise.all([
        loadDynamicStats(),
        loadStats(),
        analyzeCVEData(),
        loadDailyTrend()
      ]);
    });
  </script>
</body>
</html>